<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Debate Arena ‚Äî Powered by PrysmAI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        gpt: { DEFAULT: '#3B82F6', light: '#60A5FA', dark: '#1D4ED8' },
                        claude: { DEFAULT: '#06B6D4', light: '#22D3EE', dark: '#0891B2' },
                        arena: { bg: '#0A0A0F', card: '#111118', border: '#1E1E2E', accent: '#8B5CF6' },
                        attack: { DEFAULT: '#EF4444', light: '#F87171', dark: '#DC2626' },
                    }
                }
            }
        }
    </script>
    <style>
        body { background: #0A0A0F; }
        .glow-blue { box-shadow: 0 0 20px rgba(59, 130, 246, 0.15); }
        .glow-cyan { box-shadow: 0 0 20px rgba(6, 182, 212, 0.15); }
        .glow-red { box-shadow: 0 0 20px rgba(239, 68, 68, 0.2); }
        .typing-cursor::after { content: '‚ñä'; animation: blink 0.8s infinite; color: currentColor; opacity: 0.7; }
        @keyframes blink { 0%, 100% { opacity: 0.7; } 50% { opacity: 0; } }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-up { animation: fadeUp 0.5s ease-out forwards; }
        .prose-debate { line-height: 1.75; }
        .prose-debate p { margin-bottom: 0.75em; }
        .scrollbar-thin::-webkit-scrollbar { width: 4px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        .shimmer { background: linear-gradient(90deg, transparent 25%, rgba(255,255,255,0.05) 50%, transparent 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
    </style>
</head>
<body class="text-gray-100 min-h-screen font-sans">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <header class="border-b border-arena-border/50 backdrop-blur-xl bg-arena-bg/80 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 h-14 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-gpt to-claude flex items-center justify-center">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                </div>
                <span class="text-lg font-bold tracking-tight">AI Debate <span class="text-arena-accent">Arena</span></span>
                <span class="text-[10px] font-mono text-gray-600 border border-gray-700 px-1.5 py-0.5 rounded">v2</span>
            </div>
            <div class="flex items-center gap-2 text-xs text-gray-500 font-mono">
                <span class="w-1.5 h-1.5 rounded-full bg-emerald-500"></span>
                Powered by <a href="https://prysmai.io" target="_blank" class="text-cyan-400 hover:text-cyan-300 ml-1">PrysmAI</a>
            </div>
        </div>
    </header>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN CONTENT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <main class="max-w-7xl mx-auto px-6 py-8">

        <!-- ‚îÄ‚îÄ START SCREEN ‚îÄ‚îÄ -->
        <div id="start-screen" class="fade-up">
            <div class="text-center max-w-2xl mx-auto pt-12 pb-8">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-mono border border-arena-accent/30 bg-arena-accent/10 text-arena-accent mb-6">
                    <span class="w-1.5 h-1.5 rounded-full bg-arena-accent"></span>
                    GPT-4o Mini vs Claude Sonnet 4 ‚Äî 10 Rounds + Security Probes
                </div>
                <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight mb-4">
                    Two AIs enter.<br>
                    <span class="bg-gradient-to-r from-gpt to-claude bg-clip-text text-transparent">One argument wins.</span>
                </h1>
                <p class="text-gray-400 text-lg mb-8 max-w-lg mx-auto">
                    10 rounds of debate including adversarial prompt injection attacks. 
                    Watch how each model handles jailbreaks, role hijacking, and data exfiltration attempts ‚Äî all monitored by PrysmAI.
                </p>

                <!-- Topic Input -->
                <div class="max-w-lg mx-auto mb-4">
                    <div class="flex gap-2">
                        <input 
                            id="topic-input" 
                            type="text" 
                            placeholder="Enter a debate topic..."
                            class="flex-1 h-12 px-4 rounded-lg bg-arena-card border border-arena-border text-white placeholder-gray-500 focus:outline-none focus:border-arena-accent/50 focus:ring-1 focus:ring-arena-accent/20 text-sm"
                        >
                        <button 
                            id="start-btn"
                            onclick="startDebate()"
                            class="h-12 px-6 rounded-lg bg-gradient-to-r from-gpt to-claude text-white font-semibold text-sm hover:opacity-90 transition-opacity whitespace-nowrap"
                        >
                            Start Debate ‚Üí
                        </button>
                    </div>
                </div>

                <!-- Auto-Run Toggle -->
                <div class="max-w-lg mx-auto mb-6 flex items-center justify-center gap-3">
                    <label class="flex items-center gap-2 cursor-pointer select-none">
                        <div class="relative">
                            <input type="checkbox" id="auto-run-toggle" class="sr-only peer" checked>
                            <div class="w-9 h-5 bg-arena-border rounded-full peer-checked:bg-arena-accent/60 transition-colors"></div>
                            <div class="absolute left-0.5 top-0.5 w-4 h-4 bg-gray-300 rounded-full peer-checked:translate-x-4 peer-checked:bg-white transition-transform"></div>
                        </div>
                        <span class="text-xs text-gray-400 font-mono">Auto-advance rounds</span>
                    </label>
                    <span class="text-[10px] text-gray-600 font-mono">(3s delay between rounds)</span>
                </div>

                <!-- Preset Topics -->
                <div class="flex flex-wrap justify-center gap-2 mb-10">
                    {% for topic in preset_topics %}
                    <button 
                        onclick="selectTopic('{{ topic }}')"
                        class="px-3 py-1.5 rounded-full text-xs border border-arena-border text-gray-400 hover:text-white hover:border-gray-600 transition-colors"
                    >
                        {{ topic }}
                    </button>
                    {% endfor %}
                </div>
            </div>

            <!-- Round Structure Preview -->
            <div class="max-w-4xl mx-auto mb-12">
                <h3 class="text-sm font-semibold text-gray-400 text-center mb-4 font-mono uppercase tracking-wider">10-Round Structure</h3>
                <div class="grid grid-cols-2 sm:grid-cols-5 gap-2">
                    {% for num, info in round_types.items() %}
                    <div class="p-3 rounded-lg border {{ 'border-red-500/30 bg-red-500/5' if info.attack else 'border-arena-border bg-arena-card/50' }} text-center">
                        <div class="text-[10px] font-mono {{ 'text-red-400' if info.attack else 'text-gray-500' }} mb-1">R{{ num }}</div>
                        <div class="text-xs font-medium {{ 'text-red-300' if info.attack else 'text-gray-300' }}">{{ info.label }}</div>
                        {% if info.attack %}
                        <div class="text-[9px] font-mono text-red-500 mt-1">‚ö† {{ info.attack_type | replace('_', ' ') | title }}</div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Feature Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-3 max-w-4xl mx-auto mb-16">
                <div class="p-4 rounded-xl border border-arena-border bg-arena-card/50 text-center">
                    <div class="text-2xl mb-2">‚öîÔ∏è</div>
                    <h3 class="font-semibold text-xs mb-1">10 Rounds</h3>
                    <p class="text-[10px] text-gray-500">Opening, rebuttals, deep dive, closing</p>
                </div>
                <div class="p-4 rounded-xl border border-red-500/20 bg-red-500/5 text-center">
                    <div class="text-2xl mb-2">üõ°Ô∏è</div>
                    <h3 class="font-semibold text-xs text-red-300 mb-1">4 Attack Rounds</h3>
                    <p class="text-[10px] text-gray-500">Jailbreak, extraction, hijack, exfiltration</p>
                </div>
                <div class="p-4 rounded-xl border border-arena-border bg-arena-card/50 text-center">
                    <div class="text-2xl mb-2">üìä</div>
                    <h3 class="font-semibold text-xs mb-1">Full Observability</h3>
                    <p class="text-[10px] text-gray-500">21 API calls tracked in PrysmAI</p>
                </div>
                <div class="p-4 rounded-xl border border-arena-border bg-arena-card/50 text-center">
                    <div class="text-2xl mb-2">üîç</div>
                    <h3 class="font-semibold text-xs mb-1">Explainability</h3>
                    <p class="text-[10px] text-gray-500">Confidence heatmaps + hallucination detection</p>
                </div>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ DEBATE SCREEN ‚îÄ‚îÄ -->
        <div id="debate-screen" class="hidden">
            <!-- Topic Banner -->
            <div class="text-center mb-4">
                <div class="text-xs font-mono text-gray-500 mb-1">DEBATING</div>
                <h2 id="debate-topic" class="text-xl font-bold"></h2>
            </div>

            <!-- Progress Bar -->
            <div class="max-w-3xl mx-auto mb-4">
                <div class="flex items-center justify-between text-[10px] font-mono text-gray-500 mb-1">
                    <span id="progress-label">Round 1 of 10</span>
                    <span id="progress-pct">0%</span>
                </div>
                <div class="w-full h-1.5 bg-arena-border rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full rounded-full transition-all duration-500" style="width: 0%; background: linear-gradient(90deg, #3B82F6, #06B6D4);"></div>
                </div>
            </div>

            <!-- Round Indicator Strip -->
            <div class="flex items-center justify-center gap-1 mb-6 flex-wrap">
                {% for num in range(1, 11) %}
                <div id="round-{{ num }}-dot" class="w-7 h-7 rounded-full border {{ 'border-red-500/30' if round_types[num].attack else 'border-arena-border' }} flex items-center justify-center text-[10px] font-mono {{ 'text-red-400' if round_types[num].attack else 'text-gray-500' }}" title="{{ round_types[num].label }}">
                    {% if round_types[num].attack %}‚ö†{% else %}{{ num }}{% endif %}
                </div>
                {% if num < 10 %}
                <div class="w-3 h-0.5 bg-arena-border"></div>
                {% endif %}
                {% endfor %}
                <div class="w-3 h-0.5 bg-arena-border"></div>
                <div id="judge-dot" class="w-7 h-7 rounded-full border-2 border-arena-border flex items-center justify-center text-[10px] font-mono text-gray-500">‚öñ</div>
            </div>

            <!-- Current Round Label -->
            <div id="round-label" class="text-center mb-4">
                <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-mono border border-arena-border text-gray-400">
                    <span id="round-label-text">Starting...</span>
                </span>
            </div>

            <!-- Attack Warning Banner (hidden by default) -->
            <div id="attack-banner" class="hidden max-w-3xl mx-auto mb-4">
                <div class="flex items-center gap-3 px-4 py-2 rounded-lg border border-red-500/30 bg-red-500/5">
                    <span class="text-red-400 text-lg">üõ°Ô∏è</span>
                    <div>
                        <div class="text-xs font-semibold text-red-300">Adversarial Probe Active</div>
                        <div id="attack-type-label" class="text-[10px] font-mono text-red-400/70">Prompt injection payload injected into this round</div>
                    </div>
                </div>
            </div>

            <!-- Live Stats Panel -->
            <div id="live-stats" class="max-w-3xl mx-auto mb-4">
                <div class="grid grid-cols-4 gap-2">
                    <div class="p-2.5 rounded-lg border border-arena-border bg-arena-card/50 text-center">
                        <div class="text-[9px] font-mono text-gray-600 mb-0.5">TOTAL TOKENS</div>
                        <div id="live-total-tokens" class="text-lg font-bold text-white font-mono">0</div>
                    </div>
                    <div class="p-2.5 rounded-lg border border-arena-border bg-arena-card/50 text-center">
                        <div class="text-[9px] font-mono text-gray-600 mb-0.5">EST. COST</div>
                        <div id="live-est-cost" class="text-lg font-bold text-emerald-400 font-mono">$0.000</div>
                    </div>
                    <div class="p-2.5 rounded-lg border border-arena-border bg-arena-card/50 text-center">
                        <div class="text-[9px] font-mono text-gray-600 mb-0.5">SECURITY BLOCKS</div>
                        <div id="live-security-blocks" class="text-lg font-bold text-red-400 font-mono">0</div>
                    </div>
                    <div class="p-2.5 rounded-lg border border-arena-border bg-arena-card/50 text-center">
                        <div class="text-[9px] font-mono text-gray-600 mb-0.5">AVG TTFT</div>
                        <div id="live-avg-ttft" class="text-lg font-bold text-arena-accent font-mono">‚Äî</div>
                    </div>
                </div>
            </div>

            <!-- Debate Panels -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
                <!-- GPT Panel -->
                <div id="gpt-panel" class="rounded-xl border border-gpt/20 bg-arena-card overflow-hidden glow-blue">
                    <div class="px-4 py-3 border-b border-gpt/10 flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-gpt"></div>
                            <span class="font-semibold text-sm text-gpt-light">GPT-4o Mini</span>
                            <span class="text-[10px] font-mono text-gray-600 border border-gray-700 px-1.5 py-0.5 rounded">OpenAI ¬∑ FOR</span>
                        </div>
                        <div id="gpt-status" class="text-[10px] font-mono text-gray-600">WAITING</div>
                    </div>
                    <div id="gpt-content" class="p-4 min-h-[180px] max-h-[350px] overflow-y-auto scrollbar-thin prose-debate text-sm text-gray-300">
                        <span class="text-gray-600 italic">Waiting for debate to start...</span>
                    </div>
                    <div id="gpt-metrics" class="px-4 py-2 border-t border-gpt/10 hidden">
                        <div class="flex gap-4 text-[10px] font-mono text-gray-500">
                            <span>Latency: <span id="gpt-latency" class="text-gpt-light">‚Äî</span></span>
                            <span>TTFT: <span id="gpt-ttft" class="text-gpt-light">‚Äî</span></span>
                            <span>Tokens: <span id="gpt-tokens" class="text-gpt-light">‚Äî</span></span>
                        </div>
                    </div>
                </div>

                <!-- Claude Panel -->
                <div id="claude-panel" class="rounded-xl border border-claude/20 bg-arena-card overflow-hidden glow-cyan">
                    <div class="px-4 py-3 border-b border-claude/10 flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-claude"></div>
                            <span class="font-semibold text-sm text-claude-light">Claude Sonnet 4</span>
                            <span class="text-[10px] font-mono text-gray-600 border border-gray-700 px-1.5 py-0.5 rounded">Anthropic ¬∑ AGAINST</span>
                        </div>
                        <div id="claude-status" class="text-[10px] font-mono text-gray-600">WAITING</div>
                    </div>
                    <div id="claude-content" class="p-4 min-h-[180px] max-h-[350px] overflow-y-auto scrollbar-thin prose-debate text-sm text-gray-300">
                        <span class="text-gray-600 italic">Waiting for debate to start...</span>
                    </div>
                    <div id="claude-metrics" class="px-4 py-2 border-t border-claude/10 hidden">
                        <div class="flex gap-4 text-[10px] font-mono text-gray-500">
                            <span>Latency: <span id="claude-latency" class="text-claude-light">‚Äî</span></span>
                            <span>TTFT: <span id="claude-ttft" class="text-claude-light">‚Äî</span></span>
                            <span>Tokens: <span id="claude-tokens" class="text-claude-light">‚Äî</span></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Round History (collapsible) -->
            <div id="history-panel" class="hidden mb-6">
                <button onclick="toggleHistory()" class="flex items-center gap-2 text-xs font-mono text-gray-500 hover:text-gray-300 mb-2">
                    <span id="history-toggle-icon">‚ñ∂</span> Previous Rounds (<span id="history-count">0</span>)
                </button>
                <div id="history-content" class="hidden max-h-[300px] overflow-y-auto scrollbar-thin space-y-2">
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-center gap-3 mb-6">
                <button id="next-round-btn" class="hidden h-10 px-6 rounded-lg bg-gradient-to-r from-gpt to-claude text-white font-semibold text-sm hover:opacity-90 transition-opacity" onclick="nextRound()">
                    Next Round ‚Üí
                </button>
                <button id="judge-btn" class="hidden h-10 px-6 rounded-lg bg-gradient-to-r from-amber-500 to-orange-500 text-white font-semibold text-sm hover:opacity-90 transition-opacity" onclick="getVerdict()">
                    ‚öñÔ∏è Get Judge's Verdict
                </button>
                <button id="new-debate-btn" class="hidden h-10 px-6 rounded-lg border border-arena-border text-gray-400 text-sm hover:text-white hover:border-gray-600 transition-colors" onclick="resetDebate()">
                    New Debate
                </button>
            </div>

            <!-- Verdict Panel -->
            <div id="verdict-panel" class="hidden mb-6 fade-up">
                <div class="max-w-3xl mx-auto p-6 rounded-xl border border-amber-500/20 bg-amber-500/5">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="text-xl">‚öñÔ∏è</span>
                        <h3 class="font-bold text-amber-300">Judge's Verdict</h3>
                        <span class="text-[10px] font-mono text-gray-500 ml-auto">
                            <span id="verdict-latency">‚Äî</span> ¬∑ <span id="verdict-tokens">‚Äî</span> tokens
                        </span>
                    </div>
                    <p id="verdict-content" class="text-sm text-gray-300 leading-relaxed"></p>
                </div>
            </div>

            <!-- Debate Summary Card -->
            <div id="summary-card" class="hidden mb-6 fade-up">
                <div class="max-w-3xl mx-auto">
                    <div id="summary-card-inner" class="p-6 rounded-xl border border-arena-accent/30 bg-gradient-to-br from-arena-card via-arena-bg to-arena-card">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-2">
                                <div class="w-6 h-6 rounded-md bg-gradient-to-br from-gpt to-claude flex items-center justify-center">
                                    <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                                </div>
                                <span class="text-sm font-bold">AI Debate Arena</span>
                            </div>
                            <span class="text-[9px] font-mono text-gray-600">SESSION <span id="summary-session-id"></span></span>
                        </div>
                        <div class="mb-4">
                            <div class="text-[10px] font-mono text-gray-500 mb-1">TOPIC</div>
                            <div id="summary-topic" class="text-lg font-bold"></div>
                        </div>
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <div class="p-3 rounded-lg bg-arena-bg/50 border border-arena-border">
                                <div class="flex items-center gap-2 mb-2">
                                    <div class="w-2.5 h-2.5 rounded-full bg-gpt"></div>
                                    <span class="text-xs font-semibold text-gpt-light">GPT-4o Mini</span>
                                </div>
                                <div class="text-[10px] font-mono text-gray-500"><span id="summary-gpt-tokens" class="text-gpt-light">0</span> tokens ¬∑ <span id="summary-gpt-latency" class="text-gpt-light">0s</span></div>
                            </div>
                            <div class="p-3 rounded-lg bg-arena-bg/50 border border-arena-border">
                                <div class="flex items-center gap-2 mb-2">
                                    <div class="w-2.5 h-2.5 rounded-full bg-claude"></div>
                                    <span class="text-xs font-semibold text-claude-light">Claude Sonnet 4</span>
                                </div>
                                <div class="text-[10px] font-mono text-gray-500"><span id="summary-claude-tokens" class="text-claude-light">0</span> tokens ¬∑ <span id="summary-claude-latency" class="text-claude-light">0s</span></div>
                            </div>
                        </div>
                        <div class="grid grid-cols-4 gap-2 mb-4">
                            <div class="text-center">
                                <div class="text-lg font-bold text-white">10</div>
                                <div class="text-[9px] font-mono text-gray-600">ROUNDS</div>
                            </div>
                            <div class="text-center">
                                <div id="summary-total-tokens" class="text-lg font-bold text-white">0</div>
                                <div class="text-[9px] font-mono text-gray-600">TOKENS</div>
                            </div>
                            <div class="text-center">
                                <div id="summary-cost" class="text-lg font-bold text-emerald-400">$0.00</div>
                                <div class="text-[9px] font-mono text-gray-600">EST. COST</div>
                            </div>
                            <div class="text-center">
                                <div id="summary-blocks" class="text-lg font-bold text-red-400">0</div>
                                <div class="text-[9px] font-mono text-gray-600">BLOCKED</div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between pt-3 border-t border-arena-border">
                            <div class="flex items-center gap-1.5">
                                <span class="text-[9px] font-mono text-gray-600">Built with</span>
                                <a href="https://prysmai.io" target="_blank" class="text-[9px] font-mono text-cyan-400 hover:text-cyan-300">PrysmAI</a>
                            </div>
                            <div id="summary-winner" class="text-xs font-bold text-amber-300"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INSIGHTS PANEL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="insights-panel" class="hidden fade-up">
                <div class="border-t border-arena-border pt-8 mt-4">
                    <div class="text-center mb-6">
                        <div class="text-xs font-mono text-arena-accent mb-1">PRYSM AI INSIGHTS</div>
                        <h3 class="text-lg font-bold">Debate Analytics</h3>
                    </div>

                    <!-- Metrics Grid -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
                        <div class="p-4 rounded-lg border border-arena-border bg-arena-card text-center">
                            <div class="text-[10px] font-mono text-gray-500 mb-1">TOTAL API CALLS</div>
                            <div id="insight-total-calls" class="text-2xl font-bold text-arena-accent">‚Äî</div>
                        </div>
                        <div class="p-4 rounded-lg border border-arena-border bg-arena-card text-center">
                            <div class="text-[10px] font-mono text-gray-500 mb-1">TOTAL TOKENS</div>
                            <div id="insight-total-tokens" class="text-2xl font-bold text-white">‚Äî</div>
                        </div>
                        <div class="p-4 rounded-lg border border-arena-border bg-arena-card text-center">
                            <div class="text-[10px] font-mono text-gray-500 mb-1">ATTACK ROUNDS</div>
                            <div class="text-2xl font-bold text-red-400">4</div>
                        </div>
                        <div class="p-4 rounded-lg border border-arena-border bg-arena-card text-center">
                            <div class="text-[10px] font-mono text-gray-500 mb-1">SECURITY EVENTS</div>
                            <div id="insight-security-events" class="text-2xl font-bold text-amber-400">‚Äî</div>
                        </div>
                    </div>

                    <!-- Model Comparison -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <!-- GPT Stats -->
                        <div class="p-4 rounded-lg border border-gpt/20 bg-arena-card">
                            <div class="flex items-center gap-2 mb-3">
                                <div class="w-2.5 h-2.5 rounded-full bg-gpt"></div>
                                <span class="text-sm font-semibold text-gpt-light">GPT-4o Mini</span>
                            </div>
                            <div class="grid grid-cols-3 gap-3 text-center">
                                <div>
                                    <div class="text-[10px] font-mono text-gray-500">Total Latency</div>
                                    <div id="insight-gpt-latency" class="text-sm font-bold text-gpt-light">‚Äî</div>
                                </div>
                                <div>
                                    <div class="text-[10px] font-mono text-gray-500">Avg TTFT</div>
                                    <div id="insight-gpt-ttft" class="text-sm font-bold text-gpt-light">‚Äî</div>
                                </div>
                                <div>
                                    <div class="text-[10px] font-mono text-gray-500">Total Tokens</div>
                                    <div id="insight-gpt-tokens" class="text-sm font-bold text-gpt-light">‚Äî</div>
                                </div>
                            </div>
                        </div>

                        <!-- Claude Stats -->
                        <div class="p-4 rounded-lg border border-claude/20 bg-arena-card">
                            <div class="flex items-center gap-2 mb-3">
                                <div class="w-2.5 h-2.5 rounded-full bg-claude"></div>
                                <span class="text-sm font-semibold text-claude-light">Claude Sonnet 4</span>
                            </div>
                            <div class="grid grid-cols-3 gap-3 text-center">
                                <div>
                                    <div class="text-[10px] font-mono text-gray-500">Total Latency</div>
                                    <div id="insight-claude-latency" class="text-sm font-bold text-claude-light">‚Äî</div>
                                </div>
                                <div>
                                    <div class="text-[10px] font-mono text-gray-500">Avg TTFT</div>
                                    <div id="insight-claude-ttft" class="text-sm font-bold text-claude-light">‚Äî</div>
                                </div>
                                <div>
                                    <div class="text-[10px] font-mono text-gray-500">Total Tokens</div>
                                    <div id="insight-claude-tokens" class="text-sm font-bold text-claude-light">‚Äî</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CTA -->
                    <div class="text-center">
                        <p class="text-xs text-gray-500 mb-3">All API calls were traced through PrysmAI. View confidence heatmaps, hallucination detection, security alerts, and cost breakdown in the dashboard.</p>
                        <a id="dashboard-link" href="https://prysmai.io/dashboard" target="_blank" class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg bg-arena-accent/10 border border-arena-accent/30 text-arena-accent text-sm font-medium hover:bg-arena-accent/20 transition-colors">
                            View Full Dashboard ‚Üí
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <footer class="border-t border-arena-border/30 mt-16 py-6">
        <div class="max-w-7xl mx-auto px-6 flex items-center justify-between text-xs text-gray-600">
            <span>Built with <a href="https://prysmai.io" target="_blank" class="text-cyan-400/60 hover:text-cyan-400">PrysmAI</a></span>
            <span class="font-mono">10 rounds ¬∑ 2 models ¬∑ 4 attacks ¬∑ 1 key</span>
        </div>
    </footer>

    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        let sessionId = null;
        let currentRound = 0;
        let totalRounds = 10;
        let roundTypes = {};
        let isRunning = false;
        let autoRunEnabled = true;
        let securityBlockCount = 0;
        let metrics = {
            gpt: { totalLatency: 0, totalTtft: 0, totalTokens: 0, rounds: 0 },
            claude: { totalLatency: 0, totalTtft: 0, totalTokens: 0, rounds: 0 },
        };
        let roundHistory = []; // stores {round, label, type, isAttack, gpt, claude}

        // Cost per 1M tokens (approximate)
        const COST_PER_1M = { gpt: 0.15, claude: 3.00 };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LIVE STATS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function updateLiveStats() {
            const totalTokens = metrics.gpt.totalTokens + metrics.claude.totalTokens;
            const gptCost = (metrics.gpt.totalTokens / 1_000_000) * COST_PER_1M.gpt;
            const claudeCost = (metrics.claude.totalTokens / 1_000_000) * COST_PER_1M.claude;
            const totalCost = gptCost + claudeCost;
            const totalTtftRounds = metrics.gpt.rounds + metrics.claude.rounds;
            const avgTtft = totalTtftRounds > 0 
                ? Math.round((metrics.gpt.totalTtft + metrics.claude.totalTtft) / totalTtftRounds) 
                : 0;

            document.getElementById('live-total-tokens').textContent = totalTokens.toLocaleString();
            document.getElementById('live-est-cost').textContent = `$${totalCost.toFixed(3)}`;
            document.getElementById('live-security-blocks').textContent = securityBlockCount;
            document.getElementById('live-avg-ttft').textContent = avgTtft > 0 ? `${avgTtft}ms` : '‚Äî';
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TOPIC SELECTION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function selectTopic(topic) {
            document.getElementById('topic-input').value = topic;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUTO-RUN TOGGLE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        document.getElementById('auto-run-toggle').addEventListener('change', (e) => {
            autoRunEnabled = e.target.checked;
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê START DEBATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        async function startDebate() {
            const topic = document.getElementById('topic-input').value.trim();
            if (!topic) return alert('Please enter a debate topic.');

            const btn = document.getElementById('start-btn');
            btn.textContent = 'Starting...';
            btn.disabled = true;

            try {
                const res = await fetch('/api/debate/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ topic }),
                });
                const data = await res.json();
                sessionId = data.session_id;
                totalRounds = data.total_rounds;
                roundTypes = data.round_types || {};

                // Switch screens
                document.getElementById('start-screen').classList.add('hidden');
                document.getElementById('debate-screen').classList.remove('hidden');
                document.getElementById('debate-topic').textContent = topic;

                // Start round 1
                currentRound = 1;
                runRound(1);

            } catch (err) {
                alert('Failed to start debate: ' + err.message);
            } finally {
                btn.textContent = 'Start Debate ‚Üí';
                btn.disabled = false;
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RUN ROUND ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function runRound(roundNum) {
            isRunning = true;
            const roundInfo = roundTypes[String(roundNum)] || {};
            const isAttack = roundInfo.attack || false;
            const attackType = roundInfo.attack_type || '';
            const roundLabel = roundInfo.label || `Round ${roundNum}`;

            // Update progress
            updateProgress(roundNum);

            // Update round label
            const labelEl = document.getElementById('round-label-text');
            labelEl.textContent = `Round ${roundNum}: ${roundLabel}`;
            
            // Update round label styling for attack rounds
            const labelContainer = labelEl.parentElement;
            if (isAttack) {
                labelContainer.className = 'inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-mono border border-red-500/30 text-red-300 bg-red-500/5';
            } else {
                labelContainer.className = 'inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-mono border border-arena-border text-gray-400';
            }

            // Show/hide attack banner
            const banner = document.getElementById('attack-banner');
            if (isAttack) {
                banner.classList.remove('hidden');
                document.getElementById('attack-type-label').textContent = 
                    `Attack type: ${attackType.replace(/_/g, ' ')} ‚Äî prompt injection payload injected`;
                // Red glow on panels
                document.getElementById('gpt-panel').classList.add('glow-red');
                document.getElementById('claude-panel').classList.add('glow-red');
            } else {
                banner.classList.add('hidden');
                document.getElementById('gpt-panel').classList.remove('glow-red');
                document.getElementById('claude-panel').classList.remove('glow-red');
            }

            // Update current round dot
            const dot = document.getElementById(`round-${roundNum}-dot`);
            if (isAttack) {
                dot.classList.add('border-red-500', 'text-red-300', 'bg-red-500/10');
            } else {
                dot.classList.add('border-arena-accent', 'text-arena-accent', 'bg-arena-accent/10');
            }

            // Hide buttons while running
            document.getElementById('next-round-btn').classList.add('hidden');
            document.getElementById('judge-btn').classList.add('hidden');

            // Reset content for this round ‚Äî clear old DOM nodes completely
            const gptContent = document.getElementById('gpt-content');
            const claudeContent = document.getElementById('claude-content');
            gptContent.textContent = '';
            claudeContent.textContent = '';
            
            // Create persistent cursor elements (avoids innerHTML manipulation)
            const gptCursor = document.createElement('span');
            gptCursor.className = 'typing-cursor';
            gptContent.appendChild(gptCursor);
            const claudeCursor = document.createElement('span');
            claudeCursor.className = 'typing-cursor';
            claudeContent.appendChild(claudeCursor);
            
            document.getElementById('gpt-status').textContent = 'WAITING';
            document.getElementById('claude-status').textContent = 'WAITING';

            // Connect SSE
            const evtSource = new EventSource(`/api/debate/${sessionId}/round/${roundNum}`);
            let currentModel = null;
            // Track full content from done events (round_end only has truncated previews)
            const roundContent = { gpt: '', claude: '' };
            const blockedModels = new Set();

            evtSource.addEventListener('round_start', (e) => {
                const data = JSON.parse(e.data);
            });

            evtSource.addEventListener('model_start', (e) => {
                const data = JSON.parse(e.data);
                currentModel = data.model;
                const statusEl = document.getElementById(`${data.model}-status`);
                statusEl.textContent = 'STREAMING';
                statusEl.classList.add('text-emerald-400');
                
                // Clear any previous content for this model but keep cursor
                const contentEl = document.getElementById(`${data.model}-content`);
                const cursor = data.model === 'gpt' ? gptCursor : claudeCursor;
                contentEl.textContent = '';
                contentEl.appendChild(cursor);
            });

            evtSource.addEventListener('token', (e) => {
                try {
                const data = JSON.parse(e.data);
                const contentEl = document.getElementById(`${data.model}-content`);
                const cursor = data.model === 'gpt' ? gptCursor : claudeCursor;
                // O(1) DOM insert: create text node and insert before cursor
                const textNode = document.createTextNode(data.content);
                contentEl.insertBefore(textNode, cursor);
                contentEl.scrollTop = contentEl.scrollHeight;
                } catch (err) { console.error('token parse error:', err); }
            });

            evtSource.addEventListener('done', (e) => {
                try {
                const data = JSON.parse(e.data);
                const model = data.model;
                
                // Save full content for history
                roundContent[model] = data.content || '';
                if (data.blocked) blockedModels.add(model);

                // Remove cursor when done
                if (!blockedModels.has(model)) {
                    const cursor = model === 'gpt' ? gptCursor : claudeCursor;
                    if (cursor.parentNode) cursor.parentNode.removeChild(cursor);
                }

                // Update status
                const statusEl = document.getElementById(`${model}-status`);
                if (!data.blocked) {
                    statusEl.textContent = 'DONE';
                    statusEl.classList.remove('text-emerald-400');
                    statusEl.classList.add('text-gray-400');
                }

                // Show metrics (even for blocked ‚Äî shows latency of the block)
                document.getElementById(`${model}-metrics`).classList.remove('hidden');
                document.getElementById(`${model}-latency`).textContent = `${(data.latency_ms / 1000).toFixed(1)}s`;
                document.getElementById(`${model}-ttft`).textContent = data.blocked ? 'N/A' : `${Math.round(data.ttft_ms)}ms`;
                document.getElementById(`${model}-tokens`).textContent = data.blocked ? '0' : (data.tokens || '‚Äî');

                // Accumulate metrics
                metrics[model].totalLatency += data.latency_ms;
                metrics[model].totalTtft += data.ttft_ms;
                metrics[model].totalTokens += (data.tokens || 0);
                metrics[model].rounds++;
                updateLiveStats();
                } catch (err) { console.error('done parse error:', err); }
            });

            evtSource.addEventListener('round_end', (e) => {
                evtSource.close();
                try {
                const data = JSON.parse(e.data);
                isRunning = false;

                // Use full content from done events, fall back to round_end preview
                roundHistory.push({
                    round: roundNum,
                    label: roundLabel,
                    type: roundInfo.type || 'unknown',
                    isAttack: isAttack,
                    attackType: attackType,
                    gpt: roundContent.gpt || data.gpt_content || '',
                    claude: roundContent.claude || data.claude_content || '',
                    gptBlocked: blockedModels.has('gpt'),
                    claudeBlocked: blockedModels.has('claude'),
                });
                updateHistoryPanel();

                // Mark round dot as complete
                if (isAttack) {
                    dot.classList.add('bg-red-500/20');
                } else {
                    dot.classList.remove('bg-arena-accent/10');
                    dot.classList.add('border-emerald-500', 'text-emerald-400', 'bg-emerald-500/10');
                    dot.classList.remove('border-arena-accent', 'text-arena-accent');
                }

                // Show appropriate button or auto-advance
                if (roundNum < totalRounds) {
                    if (autoRunEnabled) {
                        // Auto-advance after 3 seconds
                        document.getElementById('next-round-btn').classList.remove('hidden');
                        document.getElementById('next-round-btn').textContent = `Auto-advancing in 3s...`;
                        document.getElementById('next-round-btn').disabled = true;
                        setTimeout(() => {
                            document.getElementById('next-round-btn').classList.add('hidden');
                            document.getElementById('next-round-btn').disabled = false;
                            nextRound();
                        }, 3000);
                    } else {
                        document.getElementById('next-round-btn').classList.remove('hidden');
                        document.getElementById('next-round-btn').textContent = `Round ${roundNum + 1} ‚Üí`;
                    }
                } else {
                    if (autoRunEnabled) {
                        document.getElementById('judge-btn').classList.remove('hidden');
                        document.getElementById('judge-btn').textContent = '‚öñÔ∏è Auto-judging in 3s...';
                        document.getElementById('judge-btn').disabled = true;
                        setTimeout(() => {
                            document.getElementById('judge-btn').disabled = false;
                            getVerdict();
                        }, 3000);
                    } else {
                        document.getElementById('judge-btn').classList.remove('hidden');
                    }
                }
                } catch (err) { console.error('round_end parse error:', err); isRunning = false; }
            });

            evtSource.addEventListener('security_blocked', (e) => {
                try {
                const data = JSON.parse(e.data);
                blockedModels.add(data.model);
                securityBlockCount++;
                updateLiveStats();
                const model = data.model;
                const contentEl = document.getElementById(`${model}-content`);
                // Remove cursor before replacing content
                const cursor = model === 'gpt' ? gptCursor : claudeCursor;
                if (cursor.parentNode) cursor.parentNode.removeChild(cursor);
                contentEl.innerHTML = `
                    <div class="border border-red-500/30 bg-red-500/10 rounded-lg p-4 mt-2">
                        <div class="flex items-center gap-2 mb-2">
                            <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>
                            <span class="text-red-400 font-semibold text-sm font-mono">SECURITY BLOCKED</span>
                            <span class="px-2 py-0.5 rounded text-xs font-mono ${
                                data.threat_level === 'high' ? 'bg-red-500/20 text-red-300' :
                                data.threat_level === 'medium' ? 'bg-yellow-500/20 text-yellow-300' :
                                'bg-orange-500/20 text-orange-300'
                            }">${data.threat_level.toUpperCase()} ¬∑ Score ${data.threat_score}</span>
                        </div>
                        <p class="text-red-300/80 text-sm">PrysmAI detected a prompt injection attack and blocked this request before it reached the model.</p>
                        <p class="text-gray-400 text-xs mt-2 font-mono">${data.details}</p>
                    </div>
                `;
                // Update status
                const statusEl = document.getElementById(`${model}-status`);
                statusEl.textContent = 'BLOCKED';
                statusEl.classList.remove('text-emerald-400');
                statusEl.classList.add('text-red-400');
                } catch (err) { console.error('security_blocked parse error:', err); }
            });

            evtSource.addEventListener('error_event', (e) => {
                const data = JSON.parse(e.data);
                console.error('Round error:', data);
                isRunning = false;
            });

            evtSource.onerror = () => {
                if (evtSource.readyState === EventSource.CLOSED) return;
                evtSource.close();
                isRunning = false;
            };
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROGRESS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function updateProgress(roundNum) {
            const pct = Math.round((roundNum / totalRounds) * 100);
            document.getElementById('progress-bar').style.width = `${pct}%`;
            document.getElementById('progress-label').textContent = `Round ${roundNum} of ${totalRounds}`;
            document.getElementById('progress-pct').textContent = `${pct}%`;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HISTORY PANEL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function updateHistoryPanel() {
            const panel = document.getElementById('history-panel');
            const count = document.getElementById('history-count');
            const content = document.getElementById('history-content');
            
            if (roundHistory.length > 1) {
                panel.classList.remove('hidden');
            }
            count.textContent = roundHistory.length - 1; // exclude current

            // Only append the LATEST completed round (O(1) instead of rebuilding all)
            const r = roundHistory[roundHistory.length - 2]; // second-to-last = just completed
            if (!r) return;
            
            const borderColor = r.isAttack ? 'border-red-500/20' : 'border-arena-border';
            const badge = r.isAttack ? `<span class="text-[9px] font-mono text-red-400 border border-red-500/30 px-1 py-0.5 rounded">‚ö† ${r.attackType.replace(/_/g, ' ')}</span>` : '';
            const div = document.createElement('div');
            div.className = `p-3 rounded-lg border ${borderColor} bg-arena-card/30`;
            div.innerHTML = `
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-[10px] font-mono text-gray-500">R${r.round}</span>
                    <span class="text-xs font-medium text-gray-400">${escapeHtml(r.label)}</span>
                    ${badge}
                </div>
                <div class="grid grid-cols-2 gap-2 text-[11px] text-gray-500">
                    <div><span class="text-gpt-light font-medium">GPT:</span> ${r.gptBlocked ? '<span class="text-red-400">üõ°Ô∏è BLOCKED</span>' : escapeHtml((r.gpt || '').substring(0, 100)) + '...'}</div>
                    <div><span class="text-claude-light font-medium">Claude:</span> ${r.claudeBlocked ? '<span class="text-red-400">üõ°Ô∏è BLOCKED</span>' : escapeHtml((r.claude || '').substring(0, 100)) + '...'}</div>
                </div>
            `;
            content.appendChild(div);
        }

        function toggleHistory() {
            const content = document.getElementById('history-content');
            const icon = document.getElementById('history-toggle-icon');
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.textContent = '‚ñº';
            } else {
                content.classList.add('hidden');
                icon.textContent = '‚ñ∂';
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NEXT ROUND ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function nextRound() {
            currentRound++;
            runRound(currentRound);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GET VERDICT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        async function getVerdict() {
            const btn = document.getElementById('judge-btn');
            btn.textContent = '‚öñÔ∏è Judging...';
            btn.disabled = true;

            const judgeDot = document.getElementById('judge-dot');
            judgeDot.classList.remove('border-arena-border', 'text-gray-500');
            judgeDot.classList.add('border-amber-500', 'text-amber-400', 'bg-amber-500/10');

            // Update progress to 100%
            document.getElementById('progress-bar').style.width = '100%';
            document.getElementById('progress-label').textContent = 'Judging...';
            document.getElementById('progress-pct').textContent = '100%';

            // Hide attack banner
            document.getElementById('attack-banner').classList.add('hidden');

            try {
                const res = await fetch(`/api/debate/${sessionId}/judge`, { method: 'POST' });
                const data = await res.json();

                document.getElementById('verdict-panel').classList.remove('hidden');
                document.getElementById('verdict-content').textContent = data.content;
                document.getElementById('verdict-latency').textContent = `${(data.latency_ms / 1000).toFixed(1)}s`;
                document.getElementById('verdict-tokens').textContent = data.tokens || '‚Äî';

                judgeDot.classList.remove('border-amber-500', 'text-amber-400', 'bg-amber-500/10');
                judgeDot.classList.add('border-emerald-500', 'text-emerald-400', 'bg-emerald-500/10');

                document.getElementById('progress-label').textContent = 'Complete';

                updateInsights();
                document.getElementById('insights-panel').classList.remove('hidden');
                document.getElementById('new-debate-btn').classList.remove('hidden');
                btn.classList.add('hidden');

                // Populate summary card
                populateSummaryCard();
                document.getElementById('summary-card').classList.remove('hidden');

                // Update dashboard link with session_id
                const dashLink = document.getElementById('dashboard-link');
                if (dashLink && sessionId) {
                    dashLink.href = `https://prysmai.io/dashboard?session=${sessionId}`;
                }

            } catch (err) {
                alert('Failed to get verdict: ' + err.message);
            } finally {
                btn.textContent = '‚öñÔ∏è Get Judge\'s Verdict';
                btn.disabled = false;
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UPDATE INSIGHTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function updateInsights() {
            const gpt = metrics.gpt;
            const claude = metrics.claude;

            document.getElementById('insight-gpt-latency').textContent = `${(gpt.totalLatency / 1000).toFixed(1)}s`;
            document.getElementById('insight-claude-latency').textContent = `${(claude.totalLatency / 1000).toFixed(1)}s`;
            
            document.getElementById('insight-gpt-ttft').textContent = gpt.rounds > 0 ? `${Math.round(gpt.totalTtft / gpt.rounds)}ms` : '‚Äî';
            document.getElementById('insight-claude-ttft').textContent = claude.rounds > 0 ? `${Math.round(claude.totalTtft / claude.rounds)}ms` : '‚Äî';
            
            document.getElementById('insight-gpt-tokens').textContent = gpt.totalTokens || '‚Äî';
            document.getElementById('insight-claude-tokens').textContent = claude.totalTokens || '‚Äî';
            
            // Total API calls = 10 rounds √ó 2 models + 1 judge = 21
            document.getElementById('insight-total-calls').textContent = `${(gpt.rounds + claude.rounds + 1)}`;
            document.getElementById('insight-total-tokens').textContent = `${gpt.totalTokens + claude.totalTokens}`;
            
            // Security events counted live
            document.getElementById('insight-security-events').textContent = securityBlockCount;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SUMMARY CARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function populateSummaryCard() {
            const gpt = metrics.gpt;
            const claude = metrics.claude;
            const totalTokens = gpt.totalTokens + claude.totalTokens;
            const gptCost = (gpt.totalTokens / 1_000_000) * COST_PER_1M.gpt;
            const claudeCost = (claude.totalTokens / 1_000_000) * COST_PER_1M.claude;
            const totalCost = gptCost + claudeCost;

            document.getElementById('summary-session-id').textContent = sessionId ? sessionId.substring(0, 8) : '‚Äî';
            document.getElementById('summary-topic').textContent = document.getElementById('topic-input').value || 'AI Debate';
            document.getElementById('summary-gpt-tokens').textContent = gpt.totalTokens.toLocaleString();
            document.getElementById('summary-gpt-latency').textContent = `${(gpt.totalLatency / 1000).toFixed(1)}s`;
            document.getElementById('summary-claude-tokens').textContent = claude.totalTokens.toLocaleString();
            document.getElementById('summary-claude-latency').textContent = `${(claude.totalLatency / 1000).toFixed(1)}s`;
            document.getElementById('summary-total-tokens').textContent = totalTokens.toLocaleString();
            document.getElementById('summary-cost').textContent = `$${totalCost.toFixed(2)}`;
            document.getElementById('summary-blocks').textContent = securityBlockCount;

            // Extract winner from verdict
            const verdict = document.getElementById('verdict-content').textContent.toLowerCase();
            // Look for explicit winner declarations like "winner: claude" or "winner: gpt"
            const winnerMatch = verdict.match(/winner[:\s]+([\w\s.-]+?)(?:\s*\(|\s*wins|\s*‚Äî|\n|$)/i);
            let winner = 'draw';
            if (winnerMatch) {
                const winnerText = winnerMatch[1].trim().toLowerCase();
                if (winnerText.includes('claude')) winner = 'claude';
                else if (winnerText.includes('gpt')) winner = 'gpt';
            } else {
                // Fallback: check for "X wins" pattern
                if (verdict.includes('claude') && verdict.includes('wins') && verdict.indexOf('claude') < verdict.indexOf('wins') && (verdict.indexOf('claude') + 30) > verdict.indexOf('wins')) {
                    winner = 'claude';
                } else if (verdict.includes('gpt') && verdict.includes('wins') && verdict.indexOf('gpt') < verdict.indexOf('wins') && (verdict.indexOf('gpt') + 30) > verdict.indexOf('wins')) {
                    winner = 'gpt';
                }
            }
            if (winner === 'claude') {
                document.getElementById('summary-winner').textContent = 'üèÜ Claude Sonnet 4 Wins';
            } else if (winner === 'gpt') {
                document.getElementById('summary-winner').textContent = 'üèÜ GPT-4o Mini Wins';
            } else {
                document.getElementById('summary-winner').textContent = 'ü§ù Draw';
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RESET ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function resetDebate() {
            sessionId = null;
            currentRound = 0;
            roundHistory = [];
            securityBlockCount = 0;
            metrics.gpt = { totalLatency: 0, totalTtft: 0, totalTokens: 0, rounds: 0 };
            metrics.claude = { totalLatency: 0, totalTtft: 0, totalTokens: 0, rounds: 0 };
            updateLiveStats();

            // Reset round dots
            for (let i = 1; i <= 10; i++) {
                const dot = document.getElementById(`round-${i}-dot`);
                const info = roundTypes[String(i)] || {};
                const isAttack = info.attack || false;
                dot.className = `w-7 h-7 rounded-full border ${isAttack ? 'border-red-500/30' : 'border-arena-border'} flex items-center justify-center text-[10px] font-mono ${isAttack ? 'text-red-400' : 'text-gray-500'}`;
                dot.innerHTML = isAttack ? '‚ö†' : `${i}`;
            }
            const judgeDot = document.getElementById('judge-dot');
            judgeDot.className = 'w-7 h-7 rounded-full border-2 border-arena-border flex items-center justify-center text-[10px] font-mono text-gray-500';
            judgeDot.innerHTML = '‚öñ';

            // Reset progress
            document.getElementById('progress-bar').style.width = '0%';
            document.getElementById('progress-label').textContent = 'Round 1 of 10';
            document.getElementById('progress-pct').textContent = '0%';

            // Hide panels
            document.getElementById('verdict-panel').classList.add('hidden');
            document.getElementById('insights-panel').classList.add('hidden');
            document.getElementById('summary-card').classList.add('hidden');
            document.getElementById('new-debate-btn').classList.add('hidden');
            document.getElementById('next-round-btn').classList.add('hidden');
            document.getElementById('judge-btn').classList.add('hidden');
            document.getElementById('attack-banner').classList.add('hidden');
            document.getElementById('history-panel').classList.add('hidden');
            document.getElementById('history-content').innerHTML = '';

            // Reset content
            document.getElementById('gpt-content').innerHTML = '<span class="text-gray-600 italic">Waiting for debate to start...</span>';
            document.getElementById('claude-content').innerHTML = '<span class="text-gray-600 italic">Waiting for debate to start...</span>';
            document.getElementById('gpt-metrics').classList.add('hidden');
            document.getElementById('claude-metrics').classList.add('hidden');
            document.getElementById('gpt-panel').classList.remove('glow-red');
            document.getElementById('claude-panel').classList.remove('glow-red');

            // Switch screens
            document.getElementById('debate-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
            document.getElementById('topic-input').value = '';
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UTILITY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        document.getElementById('topic-input').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') startDebate();
        });
    </script>
</body>
</html>
